@model WebBaiGiang.ViewModel.TaoPhieuDiemDanhViewModel

@{
    Layout = "~/Views/Shared/_LayoutGiangvien.cshtml";
    ViewData["Title"] = "Tạo phiếu điểm danh";
}
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<link href="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/css/select2.min.css" rel="stylesheet" />
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/select2@4.1.0-rc.0/dist/js/select2.min.js"></script>
<div class="container mt-4">
    <h2>Tạo phiếu điểm danh</h2>

    <form asp-action="TaoPhieu" method="post">
        <div class="dropdown mb-3">
            <button class="btn btn-outline-secondary dropdown-toggle text-start" type="button" id="classDropdownBtn" data-bs-toggle="dropdown" aria-expanded="false">
                <span id="selectedClassesText">Dành cho lớp...</span>
            </button>
            <div class="form-group">
                <label asp-for="ExpiredInMinutes" class="control-label"></label>
                <input asp-for="ExpiredInMinutes" class="form-control" placeholder="VD: 10 phút" />
                <span asp-validation-for="ExpiredInMinutes" class="text-danger"></span>
            </div>

            <ul class="dropdown-menu p-2" aria-labelledby="classDropdownBtn" style="max-height: 200px; overflow-y: auto;">
                @if (Model.AvailableClasses != null && Model.AvailableClasses.Any())
                {
                    foreach (var item in Model.AvailableClasses)
                    {
                        <li>
                            <div class="form-check">
                                <input class="form-check-input class-checkbox" type="checkbox"
                                       value="@item.Value"
                                       id="classCheckbox_@item.Value"
                                       name="ClassIds"
                                @(Model.ClassIds.Contains(int.Parse(item.Value)) ? "checked" : "") />
                                <label class="form-check-label" for="classCheckbox_@item.Value">
                                    @item.Text
                                </label>
                            </div>
                        </li>
                    }
                }
                else
                {
                    <li><p class="text-muted ms-2">Không có lớp học nào khả dụng cho bạn.</p></li>
                }
            </ul>
        </div>

        <button type="submit" class="btn btn-primary">Tạo phiếu điểm danh</button>
    </form>
</div>

@section Scripts {
    <partial name="_ValidationScriptsPartial" />
    <script>
        $(document).ready(function() {
            // Ngăn dropdown đóng khi click vào checkbox
            $('.dropdown-menu').on('click', function(e) {
                e.stopPropagation();
            });

            // Cập nhật text hiển thị trên nút dropdown
            function updateSelectedClassesText() {
                const selectedTexts = [];
                $('.class-checkbox:checked').each(function() {
                    selectedTexts.push($(this).next('label').text().trim());
                });

                if (selectedTexts.length === 0) {
                    $('#selectedClassesText').text('Dành cho lớp...');
                } else {
                    $('#selectedClassesText').text(selectedTexts.join(', '));
                }
            }

            // Gắn sự kiện change cho tất cả các checkbox lớp
            $('.class-checkbox').on('change', updateSelectedClassesText);

            // Gọi lần đầu khi tải trang để hiển thị các lớp đã chọn (nếu có)
            updateSelectedClassesText();
        });
    </script>
}
