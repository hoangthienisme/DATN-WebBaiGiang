@using System.Security.Claims
@inject WebBaiGiang.Models.WebBaiGiangContext _context

@{
    Layout = null;

    var avatar = User.FindFirst("Avatar")?.Value;
    var name = User.FindFirst(ClaimTypes.Name)?.Value ?? "Sinh viên";
    var defaultAvatarPath = "/img/default-avatar.jpg";
    var thongTin = _context.ThongTinWebs.FirstOrDefault();
}
<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Trang Sinh viên - @ViewData["Title"]</title>

    <!-- Bootstrap & Icon -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css" rel="stylesheet" />

    <!-- Custom CSS -->
    <link href="~/css/sinhvien.css" rel="stylesheet" />
</head>
<body class="layout-sinhvien">


    <!-- HEADER -->
    <div class="header-top d-flex justify-content-between align-items-center px-4 py-2 bg-light shadow-sm">
        <div class="navbar-logo">
            <a href="@Url.Action("Index", "Home")" class="logo d-flex align-items-center">
                @if (!string.IsNullOrEmpty(thongTin?.LogoUrl))
                {
                    <img src="@thongTin.LogoUrl" alt="Logo" class="img-fluid rounded" style="height: 70px;" />
                }
                else
                {
                    <h1 class="sitename">Logo</h1>
                }
            </a>
        </div>

        <div class="custom-dropdown">
            <button class="avatar-button" type="button" id="dropdownUserToggle">
                <img src="@Url.Content(!string.IsNullOrEmpty(avatar) ? avatar : defaultAvatarPath)" alt="Avatar" class="avatar-img" />
                <span class="ms-1 d-none d-sm-inline" style="color:black">@name</span>
            </button>
            <ul class="custom-dropdown-menu" id="dropdownUserMenu">
                <li>
                    <a class="custom-dropdown-item" href="@Url.Action("Profile", "Account")">
                        <i class="bi bi-person-circle me-2"></i> Tài khoản
                    </a>
                </li>
                <li><hr class="custom-dropdown-divider" /></li>
                <li>
                    <a class="custom-dropdown-item text-danger" id="logoutLink" href="#">
                        <i class="bi bi-box-arrow-right me-2"></i> Đăng xuất
                    </a>
                </li>
            </ul>
        </div>
    </div>

    <!-- MAIN LAYOUT -->
    <div class="d-flex main-wrapper">
        <!-- SIDEBAR -->
        <nav class="sidebar" id="sidebar">
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a class="nav-link @(Context.Request.Path.Value.Contains("/SinhVien/Courses") ? "active" : "")"
                       href="@Url.Action("Courses", "SinhVien")">
                        <i class="bi bi-journal-bookmark"></i> Lớp học của tôi
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link @(Context.Request.Path.Value.Contains("/SinhVien/LichHoc") ? "active" : "")"
                       href="@Url.Action("LichHoc", "SinhVien")">
                        <i class="bi bi-calendar-week"></i> Lịch học
                    </a>
                </li>
                <li class="nav-item">
                    <a class="nav-link @(Context.Request.Path.Value.Contains("/SinhVien/ThongBao") ? "active" : "")"
                       href="@Url.Action("ThongBao", "SinhVien")">
                        <i class="bi bi-bell"></i> Thông báo
                    </a>
                </li>
            </ul>
        </nav>

        <!-- MAIN CONTENT -->
        <main class="flex-fill main-content-area">
            @RenderBody()
            @await Html.PartialAsync("_Toast")
        </main>
    </div>

    <!-- FOOTER -->
    @if (thongTin != null)
    {
        @await Html.PartialAsync("_Footer", thongTin)
    }

    <!-- LOGOUT MODAL -->
    <div id="logoutConfirmModal" class="custom-modal">
        <div class="custom-modal-content">
            <div class="custom-modal-header">
                <i class="bi bi-bell-fill modal-icon"></i>
                <h5 class="custom-modal-title">Thông báo</h5>
            </div>
            <div class="custom-modal-body">
                <p>Bạn có muốn đăng xuất khỏi ứng dụng không?</p>
            </div>
            <div class="custom-modal-footer">
                <button type="button" class="btn btn-primary" id="confirmLogoutBtn">XÁC NHẬN</button>
                <button type="button" class="btn btn-secondary" id="cancelLogoutBtn">HỦY</button>
            </div>
        </div>
    </div>

    <!-- SCRIPTS -->
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            const dropdownToggle = document.getElementById('dropdownUserToggle');
            const dropdownMenu = document.getElementById('dropdownUserMenu');

            dropdownToggle?.addEventListener('click', e => {
                dropdownMenu?.classList.toggle('show');
                e.stopPropagation();
            });

            document.addEventListener('click', e => {
                if (!dropdownToggle?.contains(e.target) && !dropdownMenu?.contains(e.target)) {
                    dropdownMenu?.classList.remove('show');
                }
            });

            document.getElementById('logoutLink')?.addEventListener('click', e => {
                e.preventDefault();
                document.getElementById('logoutConfirmModal')?.classList.add('show');
            });

            document.getElementById('confirmLogoutBtn')?.addEventListener('click', () => {
                window.location.href = '@Url.Action("Logout", "Account")';
            });

            document.getElementById('cancelLogoutBtn')?.addEventListener('click', () => {
                document.getElementById('logoutConfirmModal')?.classList.remove('show');
            });

            document.getElementById('logoutConfirmModal')?.addEventListener('click', e => {
                if (e.target === document.getElementById('logoutConfirmModal')) {
                    document.getElementById('logoutConfirmModal')?.classList.remove('show');
                }
            });
        });
    </script>

    @RenderSection("Scripts", required: false)
</body>
</html>
