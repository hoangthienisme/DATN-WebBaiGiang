@model WebBaiGiang.Models.BaiGiang

@{
    ViewData["Title"] = "Chi tiết bài giảng";
    Layout = "~/Views/Shared/_LayoutGiangvien.cshtml";
    string[] imageExts = new[] { ".jpg", ".jpeg", ".png", ".gif", ".bmp" };
    string[] videoExts = new[] { ".mp4", ".webm", ".ogg" };
}

<div class="container mt-4">
    <h2>@Model.Title</h2>
    <p>@Model.Description</p>

    @* Hiển thị nội dung chính *@
    @if (!string.IsNullOrEmpty(Model.ContentUrl))
    {
        var ext = System.IO.Path.GetExtension(Model.ContentUrl).ToLower();
        var isDriveLink = Model.ContentUrl.Contains("drive.google.com");
        <div class="mt-3">
            @if (isDriveLink)
            {
                <iframe src="@Model.ContentUrl.Replace("view?usp=sharing", "preview")"
                        width="100%" height="480" allowfullscreen></iframe>
            }
            else if (imageExts.Contains(ext))
            {
                <img src="@Model.ContentUrl" class="img-fluid rounded border shadow-sm" style="max-width: 100%; height: auto;" />
            }
            else if (videoExts.Contains(ext))
            {
                <video controls class="mt-2" style="max-width: 100%; height: auto;">
                    <source src="@Model.ContentUrl" type="video/mp4" />
                    Trình duyệt không hỗ trợ video.
                </video>
            }
            else
            {
                <a href="@Model.ContentUrl" target="_blank" class="btn btn-outline-primary">Tải tài liệu bài giảng</a>
            }
        </div>
    }

    <hr />

    @* Hiển thị danh sách chương và bài *@
    @foreach (var chuong in Model.Chuongs.OrderBy(c => c.SortOrder))
    {
        <div class="mt-4">
            <h4>Chương @chuong.SortOrder: @chuong.Title</h4>
            <ul class="list-group mt-2">
                @foreach (var bai in chuong.Bais.OrderBy(b => b.SortOrder))
                {
                    <li class="list-group-item">
                        <strong>@bai.SortOrder. @bai.Title</strong><br />
                        <p>@bai.Description</p>

                        @* Video *@
                        @if (!string.IsNullOrEmpty(bai.VideoUrl))
                        {
                            var ext = System.IO.Path.GetExtension(bai.VideoUrl).ToLower();
                            var isDrive = bai.VideoUrl.Contains("drive.google.com");

                            if (isDrive)
                            {
                                <iframe src="@bai.VideoUrl.Replace("view?usp=sharing", "preview")"
                                        width="100%" height="400" allowfullscreen class="mt-2"></iframe>
                            }
                            else if (videoExts.Contains(ext))
                            {
                                <video width="100%" controls class="mt-2">
                                    <source src="@bai.VideoUrl" type="video/mp4">
                                </video>
                            }
                            else if (imageExts.Contains(ext))
                            {
                                <img src="@bai.VideoUrl" class="img-fluid rounded mt-2" />
                            }
                        }

                        @* Tài liệu *@
                        @if (!string.IsNullOrEmpty(bai.Document))
                        {
                            var docExt = System.IO.Path.GetExtension(bai.Document).ToLower();
                            var isDrive = bai.Document.Contains("drive.google.com");
                            <div class="mt-2">
                                @if (isDrive)
                                {
                                    <iframe src="@bai.Document.Replace("view?usp=sharing", "preview")"
                                            width="100%" height="400" allowfullscreen></iframe>
                                }
                                else if (imageExts.Contains(docExt))
                                {
                                    <img src="@bai.Document" class="img-fluid rounded border" />
                                }
                                else if (videoExts.Contains(docExt))
                                {
                                    <video controls class="mt-2" style="max-width: 100%;">
                                        <source src="@bai.Document" type="video/mp4" />
                                    </video>
                                }
                                else
                                {
                                    <a href="@bai.Document" target="_blank">Tải tài liệu</a>
                                }
                            </div>
                        }
                    </li>
                }
            </ul>
        </div>
    }
</div>
